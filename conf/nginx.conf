#  Basic configuration
user nginx;
worker_processes auto;
error_log /dev/stderr info;
include /etc/nginx/modules/*.conf;
pid /var/run/nginx.pid;
{% if MAIL_PROXY|default(False) %}
# load_module "modules/ngx_mail_module.so";
{% endif %}

events {
    worker_connections  1024;
}

http {
    # Standard HTTP configuration with slight hardening
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    access_log /dev/stdout;
    sendfile on;
    gzip_vary on;
    keepalive_timeout  65;
    server_tokens off;
    absolute_redirect off;
    resolver {{ RESOLVER }} valid=30s;

    {% if REAL_IP_HEADER %}
    real_ip_header {{ REAL_IP_HEADER }};
    {% endif %}

    {% if REAL_IP_FROM %}{% for from_ip in REAL_IP_FROM.split(',') %}
    set_real_ip_from {{ from_ip }};
    {% endfor %}{% endif %}

    # Header maps
    map $http_x_forwarded_proto $proxy_x_forwarded_proto {
      default $http_x_forwarded_proto;
      ''      $scheme;

    }
    include /etc/nginx/conf.d/*.conf;
}